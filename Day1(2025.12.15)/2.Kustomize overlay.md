# Chapter 1. Declarative Resource Management


## 1.3. Kustomize 오버레이
애플리케이션을 구성하는 Kubernetes 리소스를 base 디렉터리로 공통화하고,
Kustomize를 활용해 개발·스테이징·테스트·운영 환경별 overlay를 구성하여
환경별 설정 차이만 반영해 적용할 수 있다.
리소스를 복사하지않고 재활용하는 것이 핵심가치!

### Kustomize 활용할 때, 디렉터리 구조

```code
k8s/
 ├─ base/
 │   ├─ deployment.yaml
 │   ├─ service.yaml
 │   └─ kustomization.yaml
 └─ overlays/
     ├─ dev/
     │   ├─ kustomization.yaml
     │   └─ patch.yaml
     ├─ staging/
     └─ prod/
```
•	base : 공통 리소스
•	overlays : replica 수, image tag, resource limit, env 등만 수정


### project 생성하고 Kustomize 활용해서 해당 프로젝트에 앱 만든 후, 로그 모니터링

#### 프로젝트 생성
oc new-project 프로젝트 명

#### 프로젝트 내부에 기본 설정으로 앱 배포
oc apply -k 설정디렉토리 명

#### 배포된 앱 모니터링
watch oc get all

##### watch로 확인 가능한 로그

1) 전체 출력 예시

```bash
NAME                           READY   STATUS    RESTARTS   AGE
pod/my-app-7d8f9c5b6d-abc12    1/1     Running   0          5m
pod/my-app-7d8f9c5b6d-xyz34    1/1     Running   0          5m

NAME                     READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/my-app   2/2     2            2           10m
                         ^^^     
                        여기가 복제본 수!

NAME                                DESIRED   CURRENT   READY   AGE
replicaset.apps/my-app-7d8f9c5b6d   2         2         2       10m
                                    ^^^
                                    여기도 복제본 수!
```

2) Deployment 로그

```bash
deployment.apps/my-app   2/2     2            2           10m
                         │││
                         ││└─ AVAILABLE (사용 가능한 복제본)
                         │└── UP-TO-DATE (최신 버전 복제본)
                         └─── READY (준비된/원하는 복제본)
                              2/2 = 2개 원함 / 2개 준비됨
```


3) Replicaset 로그

```bash
replicaset.apps/my-app-7d8f9c5b6d   2         2         2       10m
                                    │         │         │
                                    │         │         └─ READY
                                    │         └─────────── CURRENT
                                    └─────────────────── DESIRED (원하는 수)
```

##### 참고 : yaml 파일 문법
key 값은 camelCaseStyle로 작성해주어야 한다.


##### 참고 : 환경설정 추출할 때
이미 만들어져있는 secret값을 추출할때는
oc oc extract secret/db-secrets-55cbgc8c6m --to=-
와 같이 "/"를 사용한다. 
또, "--to=-" 와 같이 설정하면 모니터 창에서만 보인다.

