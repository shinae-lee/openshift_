# Chapter 1. Declarative Resource Management


## 1.3. Kustomize ì˜¤ë²„ë ˆì´
ì• í”Œë¦¬ì¼€ì´ì…˜ì„ êµ¬ì„±í•˜ëŠ” Kubernetes ë¦¬ì†ŒìŠ¤ë¥¼ base ë””ë ‰í„°ë¦¬ë¡œ ê³µí†µí™”í•˜ê³ ,
Kustomizeë¥¼ í™œìš©í•´ ê°œë°œÂ·ìŠ¤í…Œì´ì§•Â·í…ŒìŠ¤íŠ¸Â·ìš´ì˜ í™˜ê²½ë³„ overlayë¥¼ êµ¬ì„±í•˜ì—¬
í™˜ê²½ë³„ ì„¤ì • ì°¨ì´ë§Œ ë°˜ì˜í•´ ì ìš©í•  ìˆ˜ ìˆë‹¤.
ë¦¬ì†ŒìŠ¤ë¥¼ ë³µì‚¬í•˜ì§€ì•Šê³  ì¬í™œìš©í•˜ëŠ” ê²ƒì´ í•µì‹¬ê°€ì¹˜!

### Kustomize í™œìš©í•  ë•Œ, ë””ë ‰í„°ë¦¬ êµ¬ì¡°

```code
k8s/
 â”œâ”€ base/
 â”‚   â”œâ”€ deployment.yaml
 â”‚   â”œâ”€ service.yaml
 â”‚   â””â”€ kustomization.yaml
 â””â”€ overlays/
     â”œâ”€ dev/
     â”‚   â”œâ”€ kustomization.yaml
     â”‚   â””â”€ patch.yaml
     â”œâ”€ staging/
     â””â”€ prod/
```
â€¢	base : ê³µí†µ ë¦¬ì†ŒìŠ¤
â€¢	overlays : replica ìˆ˜, image tag, resource limit, env ë“±ë§Œ ìˆ˜ì •

### Kustomize ë¡œ ë¦¬ì†ŒìŠ¤ ë³´ê¸° ë° ë°°í¬,ì‚­ì œ

1. Kustomize ì‚¬ìš©í•´ì„œ YAML ìƒì„±

```code
kubectl kustomize overlay/production
```
ì´ ëª…ë ¹ì€:
	1)	overlay/production/kustomization.yaml ì„ ì½ê³ 
	2)	ê±°ê¸°ì— ì§€ì •ëœ resources, bases, patches ë“±ì„ ëª¨ë‘ ì ìš©í•´ì„œ
	3)	ìµœì¢… Kubernetes YAMLì„ ìƒì„±
	4)	ê·¸ ê²°ê³¼ë¥¼ í„°ë¯¸ë„ì— ì¶œë ¥
	5)	âŒ Kubernetes í´ëŸ¬ìŠ¤í„°ì—ëŠ” ì•„ë¬´ ìš”ì²­ë„ ì•ˆ ë³´ëƒ„

ğŸ‘‰ ì¦‰, ìˆœìˆ˜ YAML ìƒì„±ê¸°

2. í•´ë‹¹ YAMLì„ í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ì— ì ìš©

```code
kubectl apply -k overlay/production
``` 

3. kustomize ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ ì‚­ì œ

```code
oc delete -k overlay/production
```


### project ìƒì„±í•˜ê³  Kustomize í™œìš©í•´ì„œ í•´ë‹¹ í”„ë¡œì íŠ¸ì— ì•± ë§Œë“  í›„, ë¡œê·¸ ëª¨ë‹ˆí„°ë§

#### í”„ë¡œì íŠ¸ ìƒì„±
oc new-project í”„ë¡œì íŠ¸ ëª…

#### í”„ë¡œì íŠ¸ ë‚´ë¶€ì— ê¸°ë³¸ ì„¤ì •ìœ¼ë¡œ ì•± ë°°í¬
oc apply -k ì„¤ì •ë””ë ‰í† ë¦¬ ëª…

#### ë°°í¬ëœ ì•± ëª¨ë‹ˆí„°ë§
watch oc get all

##### watchë¡œ í™•ì¸ ê°€ëŠ¥í•œ ë¡œê·¸

1) ì „ì²´ ì¶œë ¥ ì˜ˆì‹œ

```bash
NAME                           READY   STATUS    RESTARTS   AGE
pod/my-app-7d8f9c5b6d-abc12    1/1     Running   0          5m
pod/my-app-7d8f9c5b6d-xyz34    1/1     Running   0          5m

NAME                     READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/my-app   2/2     2            2           10m
                         ^^^     
                        ì—¬ê¸°ê°€ ë³µì œë³¸ ìˆ˜!

NAME                                DESIRED   CURRENT   READY   AGE
replicaset.apps/my-app-7d8f9c5b6d   2         2         2       10m
                                    ^^^
                                    ì—¬ê¸°ë„ ë³µì œë³¸ ìˆ˜!
```

2) Deployment ë¡œê·¸

```bash
deployment.apps/my-app   2/2     2            2           10m
                         â”‚â”‚â”‚
                         â”‚â”‚â””â”€ AVAILABLE (ì‚¬ìš© ê°€ëŠ¥í•œ ë³µì œë³¸)
                         â”‚â””â”€â”€ UP-TO-DATE (ìµœì‹  ë²„ì „ ë³µì œë³¸)
                         â””â”€â”€â”€ READY (ì¤€ë¹„ëœ/ì›í•˜ëŠ” ë³µì œë³¸)
                              2/2 = 2ê°œ ì›í•¨ / 2ê°œ ì¤€ë¹„ë¨
```


3) Replicaset ë¡œê·¸

```bash
replicaset.apps/my-app-7d8f9c5b6d   2         2         2       10m
                                    â”‚         â”‚         â”‚
                                    â”‚         â”‚         â””â”€ READY
                                    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CURRENT
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DESIRED (ì›í•˜ëŠ” ìˆ˜)
```

##### ì°¸ê³  : yaml íŒŒì¼ ë¬¸ë²•
key ê°’ì€ camelCaseStyleë¡œ ì‘ì„±í•´ì£¼ì–´ì•¼ í•œë‹¤.


##### ì°¸ê³  : í™˜ê²½ì„¤ì • ì¶”ì¶œí•  ë•Œ
ì´ë¯¸ ë§Œë“¤ì–´ì ¸ìˆëŠ” secretê°’ì„ ì¶”ì¶œí• ë•ŒëŠ”
oc oc extract secret/db-secrets-55cbgc8c6m --to=-
ì™€ ê°™ì´ "/"ë¥¼ ì‚¬ìš©í•œë‹¤. 
ë˜, "--to=-" ì™€ ê°™ì´ ì„¤ì •í•˜ë©´ ëª¨ë‹ˆí„° ì°½ì—ì„œë§Œ ë³´ì¸ë‹¤.

