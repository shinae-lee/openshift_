# Chapter3. Authentication and Authorization 


## 3-2.  Define and Apply Permissions with RBAC (Role-based Access Control)

사용자와 권한을 관리하는 방법.

인증(Authentication) : 누가? 혹은 어떤 계정 또는 사용자가? 에 해당
권한 부여(Authorization) : 무엇(Resource)을 어떻게 할것인가

RBAC(Role-based Access Control) 이란, 권한을 역할(role) 기준으로 부여 하는 것.


### RBAC의 대상 (= 리소스)

pods, services, deployments, configmaps, secrets, nodes, namespaces


### Role 권한(rules) 설정 시 verb 

| verb   | 의미    |
| ------ | ----- |
| get    | 하나 조회 |
| list   | 목록 조회 |
| watch  | 변경 감시 |
| create | 생성    |
| update | 수정    |
| patch  | 부분 수정 |
| delete | 삭제    |


### Role 리소스 생성시 rules 설정 예시 : get, list, watch

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: pod-reader
  namespace: default
rules:
- apiGroups: [""]
  resources: ["pods"]
  verbs: ["get", "list", "watch"] ## 단건, 목록, 스트림 조회 권한 설정
```


위의 예에서 role 이 허용하는 것


```code
oc get pod nginx : get(단 건 조회) 권한  
oc get pods: list(목록 조회) 권한  
oc get pods -w (pod가 바뀌는 상태를 실시간 모니터링) : watch 권한    
```


### RoleBinding 하는 법

#### 참고 : web console창 여는 법


```code
oc whoami --show-console
```

이후 나오는 링크를 마우스 우클릭 후, openlink해서 열기
나오는 console 화면의  
1번 버튼: kubeadmin 권한, 2번 버튼: LDAP권한, 3번 버튼: htpasswd권한


### 시험에 잘 나온다 : 프로젝트 생성 권한 (self-provisioner)

1. role 확인
    ```code
    oc get clusterrole |grep self-provisioner
    ```

2. role 역할 확인
    ```code
    oc describe clusterrole self-provisioner
    ```
3. role 이 binding된 그룹 보기
    ```code
    oc describe clusterrolebinding self-provisioner
    ```
    --> 검색되는 그룹이 있을텐데 그 그룹을 삭제하면 project 생성 못하게 막을 수있다.

