# Chapter4. Network Security

## 4-1. Protect External Traffic with TLS

### deployment를 만들면,

deployment, pod, replicaset의 세가지 리소스가 만들어진다.
외부에서 curl명령어로 deployment로 접근하기 위해서는 "service"가 필요하다.

또, deployment와 replicaset이 있으면 pod가 죽어도 최소 1개는 만든다.

oc create로 deployment 만들면,
label의 key는 항상 app, value는 항상 deployment이름이다.

### Labael Selector 
service의 라벨이 deployment와 같이 만들지 않으면 label selector가 못찾음.  
그래서 아래와 같이 port를 찾아줘야한다

```code
oc get po --show-labels
```

### 서비스 생성

```code
oc expose deployment/nginx-deploy --port 8080
```

### service 확인

```code
oc describe svc nginx-deploy
```

```code
oc get svc
```

### 같은 cluster내부에서 접속 ip 확인하는 코드

```code
oc get endpoints
```
--> cluster외부에서 접속하기 위해서는 ingress(k8s)나 router(openshift)가 필요하다.

참고로 할 점은 ingress와 router모두 http/https의 웹 패킷만 라우팅 가능하다.  
FTP,NFS같은 패킷은 4계층의 트래픽을 처리하므로 ingress,router가 불가능하고 따로 LoadBalancer Service나 NodePort type의 Service를 만들어서 써야한다. 

### 외부에서 다른 클러스터 service에 접속하기위해서 router생성

```code
oc expose svc nginx-deploy
```

### service Load balancing

node로 round robin으로 부하분산

### k8s SDN (software definition network)

쿠버네티스는 옆 노드와 바로 통신가능 (도커와 달리)
장비의 sdn대역과 node(pod) 대역은 둘다 사설 ip이긴하지만 다르다 -- 보강하기

### tls 암호화 방식 : edge 방식
edge route 가 client와 router사이만 암호화함.
인증서는 컨테이너(서버)가 만듦.
tls.crt : 공개키
tls.key : 개인키

### tls 암호화 방식 : passthrough 방식
컨테이너가 키를 만들기만하고, 노드에다가 mount해서 key를 사용하기 때문에
컨테이너가 사라져서 키가 없어져도 node는 계속 키를 사용할 수 있음.
router가 암호화하지는 않고 중개만 해줌.

### tls 암호화 방식 : 재암호화 방식


### IngressController임 
/etc/pki/tls가있음. 
